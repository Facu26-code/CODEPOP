<!DOCTYPE html> 
<html lang="es"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>CODEPOP - Pixel Edition</title> 
     
    <style> 
        /* Importamos la fuente de videojuego */ 
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap'); 
 
        :root { 
            --pixel-bg: #1a1a2e; 
            --pixel-panel: #0f3460; 
            --pixel-border: #30344c; 
            --neon-blue: #00f3ff; 
            --neon-orange: #ff9f43; 
        } 
 
        body { 
            background: var(--pixel-bg); 
            /* Un peque√±o patr√≥n de grilla para el fondo */ 
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); 
            background-size: 20px 20px; 
            color: white; 
            /* Aplicamos la fuente retro a TODO */ 
            font-family: 'Press Start 2P', cursive; 
            text-align: center; 
            padding: 20px; 
            margin: 0; 
            letter-spacing: -1px; /* La fuente es ancha, juntamos las letras */ 
        } 
 
        /* RESET GLOBAL PARA PIXEL ART: Todo cuadrado, sombras duras */ 
        * { 
            border-radius: 0px !important; /* Chau curvas */ 
            box-shadow: none !important; /* Reseteamos sombras suaves */ 
            text-shadow: 3px 3px 0px #000000 !important; /* Sombra de texto dura */ 
            transition: none !important; /* Los pixels no tienen transiciones suaves */ 
        } 
 
        h1 { font-size: 1.2em; margin-bottom: 15px; color: var(--neon-blue); } 
        h3 { font-size: 0.9em; margin: 15px 0; } 
 
        /* Paneles y Cajas: Bloques s√≥lidos con sombra negra */ 
        .panel-control, .caja-total { 
            background: var(--pixel-panel); 
            padding: 20px; 
            display: inline-block; 
            border: 4px solid var(--pixel-border); 
            /* Sombra dura desplazada */ 
            box-shadow: 8px 8px 0px black !important; 
            margin-bottom: 25px; 
            width: 90%; 
            max-width: 500px; 
        } 
 
        /* Inputs y Selects Pixelados */ 
        input, select { 
            padding: 10px 5px; 
            border: 3px solid var(--pixel-border); 
            background-color: #1a1a2e; 
            color: var(--neon-blue); 
            width: 90%; 
            margin-bottom: 15px; 
            outline: none; 
            font-size: 0.7em; /* Fuente m√°s chica */ 
            text-align: center; 
            font-family: 'Press Start 2P', cursive; 
        } 
 
        input:focus, select:focus {  
            border-color: var(--neon-blue); 
            background-color: #000; 
            /* Al hacer foco, la sombra dura cambia de color */ 
            box-shadow: 4px 4px 0px var(--neon-blue) !important; 
        } 
 
        .btn-container { display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap;} 
 
        /* Botones tipo Arcade */ 
        button { 
            cursor: pointer; 
            border: 3px solid #000; 
            font-weight: bold; 
            padding: 15px 10px; 
            font-size: 0.6em; 
            font-family: 'Press Start 2P', cursive; 
            position: relative; 
            /* Efecto de bot√≥n levantado */ 
            top: -4px; left: -4px; 
            box-shadow: 4px 4px 0px #000 !important; 
        } 
 
        /* Efecto al presionar el bot√≥n */ 
        button:active {  
            top: 0px; left: 0px; 
            box-shadow: 0px 0px 0px #000 !important; 
        } 
 
        .btn-add { background: var(--neon-blue); color: #000; text-shadow: none !important; } 
        .btn-empty { background: #ff0055; color: white; } 
        .btn-excel { background: #1D6F42; color: white; } 
        .btn-open { background: #6c5ce7; color: white; margin-left: 10px; } 
        .btn-whatsapp { background: #25D366; color: white; } 
 
        ul { list-style-type: none; padding: 0; max-width: 500px; margin: 0 auto; } 
 
        /* Items de la lista */ 
        li { 
            background-color: var(--pixel-panel); 
            margin: 15px 0; 
            padding: 15px; 
            border: 3px solid var(--pixel-border); 
            /* Borde izquierdo grueso y pixelado */ 
            border-left: 8px solid var(--neon-blue); 
            box-shadow: 6px 6px 0px black !important; 
            display: flex; justify-content: space-between; align-items: center; 
            text-align: left; 
            animation: aparecer 0.2s steps(5); /* Animaci√≥n escalonada */ 
        } 
         
        li.mano-obra { border-left: 8px solid var(--neon-orange); } 
 
        .info-producto { display: flex; flex-direction: column; gap: 5px; } 
        .nombre-item { font-size: 0.8em; color: #fff; } 
        .detalle-item { font-size: 0.6em; color: #aaa; text-shadow: 1px 1px 0px #000 !important; } 
         
        /* Badges cuadraditos */ 
        .rubro-badge, .cantidad-badge { 
            background: #000; border: 2px solid var(--neon-orange); color: var(--neon-orange); 
            font-size: 0.5em; padding: 2px 4px; margin-left: 5px; text-shadow: none !important; 
        } 
        .cantidad-badge { border-color: var(--neon-blue); color: var(--neon-blue); margin-right: 5px; } 
 
        .acciones { display: flex; gap: 5px; } 
 
        .btn-delete, .btn-edit { 
            width: auto; height: auto; padding: 5px 8px; font-size: 0.8em; 
            top: -2px; left: -2px; box-shadow: 2px 2px 0px #000 !important; 
        } 
        .btn-delete { background: #ff4d4d; color: white; border-color: #000; } 
        .btn-edit { background: #ffcc00; color: black; border-color: #000; text-shadow: none !important;} 
 
        .caja-total { 
            background: linear-gradient(45deg, #00b09b, #96c93d); 
            /* En pixel art, los gradientes se ven raros, mejor color s√≥lido */ 
            background: #00b09b; 
            border: 4px solid #fff; 
        } 
         
        .subtotales { 
            font-size: 0.6em; margin-bottom: 15px; 
            border-bottom: 3px dashed rgba(255,255,255,0.5); padding-bottom: 15px; 
            text-align: left; 
        } 
 
        @keyframes aparecer { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        } 
         
        .titulo-seccion { 
            text-align: left; max-width: 500px; margin: 30px auto 10px auto; 
            font-size: 0.7em; color: var(--neon-blue); 
            border-bottom: 4px solid var(--pixel-border); 
            padding-bottom: 5px; 
        } 
        /* Ajustes para SweetAlert en modo pixel */ 
        div:where(.swal2-container) h2:where(.swal2-title), div:where(.swal2-container) div:where(.swal2-html-container) { 
             font-family: 'Press Start 2P', cursive !important; text-shadow: none !important; letter-spacing: -1px; 
        } 
        div:where(.swal2-container) button:where(.swal2-styled) { 
            border-radius: 0 !important; box-shadow: 4px 4px 0px #000 !important; font-family: 'Press Start 2P', cursive !important; 
        } 
    </style> 
 
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script> 
 
</head> 
 
<body> 
 
    <div id="vista-clientes"> 
        <h1>üëæ MIS PROYECTOS üëæ</h1> 
         
        <div class="panel-control"> 
            <input type="text" id="nuevoClienteInput" placeholder="Nombre Cliente (Ej: Juan)"> 
             
            <select id="rubroInput"> 
                <option value="‚ö° Electricidad">‚ö° Electricidad</option> 
                <option value="üîß Mec√°nica">üîß Mec√°nica</option> 
                <option value="üìã Gestor Automotor">üìã Gestor Automotor</option> 
                <option value="üî• Gasista">üî• Gasista</option> 
                <option value="üõ†Ô∏è Varios">üõ†Ô∏è Varios</option> 
            </select> 
 
            <div class="btn-container"> 
                <button class="btn-add" onclick="crearNuevoCliente()">+ START</button> 
            </div> 
        </div> 
 
        <ul id="listaClientesVisual"></ul> 
    </div> 
 
 
    <div id="vista-presupuesto" style="display:none;"> 
         
        <div style="text-align: left; max-width: 500px; margin: 0 auto; margin-bottom: 20px;"> 
            <button class="btn-empty" onclick="volverInicio()">‚óÄ BACK</button> 
        </div> 
 
        <h1 id="tituloPresupuesto">PRESUPUESTO</h1> 
        <h4 id="subtituloRubro" style="color:var(--neon-blue); margin-top:-10px; font-size: 0.7em;"></h4> 
         
        <div class="panel-control"> 
            <select id="tipoItemInput" style="background-color: #2c3e50; border-color: var(--neon-blue);"> 
                <option value="material">üî© MATERIAL</option> 
                <option value="mano_obra">üë∑ MANO DE OBRA</option> 
            </select> 
 
            <input list="listaPrecios" type="text" id="nombreInput" placeholder="Descripci√≥n ITEM"> 
            <datalist id="listaPrecios"></datalist> 
 
            <input type="number" id="cantidadInput" placeholder="CANT." min="1"> 
            <input type="number" id="precioInput" placeholder="$ PRECIO" min="0"> 
             
            <div class="btn-container"> 
                <button class="btn-add" onclick="agregarProducto()">SAVE ITEM</button> 
                <button class="btn-excel" onclick="descargarExcel()">üíæ EXCEL</button> 
                <button class="btn-whatsapp" onclick="compartirWhatsapp()">üìû WHATSAPP</button> 
            </div> 
        </div> 
 
        <div id="contenedorListas"></div> 
 
        <div class="caja-total"> 
            <div class="subtotales"> 
                üî© Materiales: $<span id="totalMateriales">0</span> <br> 
                <div style="height: 10px;"></div> üë∑ Mano de Obra: $<span id="totalManoObra">0</span> 
            </div> 
            <h3>üí∞ TOTAL: $<span id="precioTotal">0</span></h3> 
        </div> 
    </div> 
 
    <script> 
        let baseDatos = JSON.parse(localStorage.getItem('CODEPOP_DB')) || []; 
        let clienteActualIndex = null; 
 
        // --- BASE DE PRECIOS DE MERCADO --- 
        const PRECIOS_MERCADO = { 
            "material": [ 
                { nombre: "Cable 2.5mm (Rollo)", precio: 45000 }, 
                { nombre: "Cable 1.5mm (Rollo)", precio: 38000 }, 
                { nombre: "Tecla Punto y Toma", precio: 3500 }, 
                { nombre: "Cinta Aisladora", precio: 1500 }, 
                { nombre: "Aceite 10w40", precio: 12000 }, 
                { nombre: "Filtro de Aire", precio: 8000 }, 
                { nombre: "Formularios Tipo 08", precio: 5000 } 
            ], 
            // LISTA DE MANO DE OBRA ACTUALIZADA 
            "mano_obra": { 
                "‚ö° Electricidad": [ 
                    { nombre: "Boca de luz (Instalaci√≥n)", precio: 15000 }, 
                    { nombre: "Cambio de T√©rmica", precio: 25000 }, 
                    { nombre: "Urgencia 24hs", precio: 40000 } 
                ], 
                "üîß Mec√°nica": [ 
                    { nombre: "Electricidad Automotriz", precio: 25000 }, 
                    { nombre: "Escaneo Computarizado", precio: 20000 }, 
                    { nombre: "Mec√°nica Integral", precio: 30000 }, 
                    { nombre: "Cambio de Aceite", precio: 10000 } 
                ], 
                "üìã Gestor Automotor": [ 
                    { nombre: "Transferencia Automotor", precio: 50000 }, 
                    { nombre: "Cambio de Dominio", precio: 40000 }, 
                    { nombre: "C√©dula Azul/Verde", precio: 15000 }, 
                    { nombre: "Informe de Dominio", precio: 10000 } 
                ], 
                "üî• Gasista": [ 
                    { nombre: "Instalaci√≥n Estufa", precio: 35000 }, 
                    { nombre: "B√∫squeda de Fuga", precio: 40000 }, 
                    { nombre: "Matriculaci√≥n", precio: 60000 } 
                ], 
                "üõ†Ô∏è Varios": [ 
                    { nombre: "Trabajos de Oficina", precio: 10000 }, 
                    { nombre: "Finanzas / Contador", precio: 20000 }, 
                    { nombre: "Tr√°mites Generales", precio: 8000 } 
                ] 
            } 
        }; 
 
        // --- GESTI√ìN DE CLIENTES --- 
 
        const crearNuevoCliente = () => { 
            let nombre = document.getElementById('nuevoClienteInput').value; 
            let rubro = document.getElementById('rubroInput').value; 
             
            if (nombre === "") { 
                Swal.fire({ title: 'Falta nombre', icon: 'warning', background: '#1a1a2e', color: '#fff', confirmButtonText: 'OK' }); 
                return; 
            } 
 
            let nuevoCliente = { 
                id: Date.now(),  
                nombre: nombre, 
                rubro: rubro, 
                items: []  
            }; 
 
            baseDatos.push(nuevoCliente); 
            guardarDB(); 
             
            document.getElementById('nuevoClienteInput').value = ""; 
            mostrarClientes();  
        } 
 
        const mostrarClientes = () => { 
            let listaHTML = document.getElementById('listaClientesVisual'); 
            listaHTML.innerHTML = ""; 
 
            if(baseDatos.length === 0) { 
                listaHTML.innerHTML = "<p style='color:#aaa; font-size: 0.8em;'>INSERT COIN (No hay proyectos)</p>"; 
                return; 
            } 
 
            baseDatos.forEach((cliente, index) => { 
                let totalItems = cliente.items.length; 
                let rubroMostrar = cliente.rubro || 'üõ†Ô∏è Varios';  
                 
                let li = document.createElement('li');

                let divInfo = document.createElement('div');
                divInfo.className = 'info-producto';

                let spanNombre = document.createElement('span');
                spanNombre.className = 'nombre-item';
                spanNombre.textContent = cliente.nombre + ' ';

                let spanRubro = document.createElement('span');
                spanRubro.className = 'rubro-badge';
                spanRubro.textContent = rubroMostrar;
                
                spanNombre.appendChild(spanRubro);

                let spanDetalle = document.createElement('span');
                spanDetalle.className = 'detalle-item';
                spanDetalle.textContent = totalItems + ' items guardados';

                divInfo.appendChild(spanNombre);
                divInfo.appendChild(spanDetalle);

                let divAcciones = document.createElement('div');

                let btnDelete = document.createElement('button');
                btnDelete.className = 'btn-delete';
                btnDelete.textContent = 'DEL';
                btnDelete.onclick = () => borrarCliente(index);

                let btnOpen = document.createElement('button');
                btnOpen.className = 'btn-open';
                btnOpen.textContent = 'OPEN';
                btnOpen.onclick = () => abrirPresupuesto(index);

                divAcciones.appendChild(btnDelete);
                divAcciones.appendChild(btnOpen);

                li.appendChild(divInfo);
                li.appendChild(divAcciones);
                
                listaHTML.appendChild(li);
            }); 
        } 
 
        const borrarCliente = (index) => { 
            Swal.fire({ 
                title: '¬øGAME OVER?', 
                text: "Se perder√°n todos los datos.", 
                icon: 'warning', 
                showCancelButton: true, 
                confirmButtonColor: '#d33', 
                cancelButtonColor: '#30344c', 
                background: '#1a1a2e', color: '#fff', 
                confirmButtonText: 'YES, DELETE', 
                cancelButtonText: 'NO, WAIT' 
            }).then((result) => { 
                if (result.isConfirmed) { 
                    baseDatos.splice(index, 1); 
                    guardarDB(); 
                    mostrarClientes(); 
                } 
            }) 
        } 
 
        const abrirPresupuesto = (index) => { 
            clienteActualIndex = index; 
            let cliente = baseDatos[index]; 
 
            document.getElementById('tituloPresupuesto').innerText = "LEVEL: " + cliente.nombre.toUpperCase(); 
            document.getElementById('subtituloRubro').innerText = cliente.rubro || "Rubro: Varios"; 
 
            document.getElementById('vista-clientes').style.display = 'none'; 
            document.getElementById('vista-presupuesto').style.display = 'block'; 
 
            document.getElementById('tipoItemInput').value = "material"; 
            cambiarPlaceholders(); 
            actualizarSugerencias(); 
 
            actualizarVistaPresupuesto(); 
        } 
 
        const volverInicio = () => { 
            clienteActualIndex = null;  
            document.getElementById('vista-presupuesto').style.display = 'none'; 
            document.getElementById('vista-clientes').style.display = 'block'; 
            mostrarClientes();  
        } 
 
        // --- L√ìGICA INTELIGENTE DE PRECIOS Y VISIBILIDAD --- 
 
        const cambiarPlaceholders = () => { 
            let tipo = document.getElementById('tipoItemInput').value; 
            let nombreInput = document.getElementById('nombreInput'); 
            let cantidadInput = document.getElementById('cantidadInput'); 
            let precioInput = document.getElementById('precioInput'); 
 
            if (tipo === 'mano_obra') { 
                nombreInput.placeholder = "Trabajo a realizar..."; 
                precioInput.placeholder = "$ Precio Final"; 
                 
                cantidadInput.style.display = 'none'; 
                cantidadInput.value = 1;  
            } else { 
                nombreInput.placeholder = "Material (Ej: Cable)"; 
                precioInput.placeholder = "$ Precio Unitario"; 
                 
                cantidadInput.style.display = 'inline-block'; 
                cantidadInput.value = "";  
            } 
            actualizarSugerencias(); 
        } 
 
        const actualizarSugerencias = () => { 
            let tipo = document.getElementById('tipoItemInput').value; 
            let cliente = baseDatos[clienteActualIndex]; 
            let rubro = cliente.rubro || "üõ†Ô∏è Varios"; 
            let lista = document.getElementById('listaPrecios'); 
             
            lista.innerHTML = "";  
 
            let opciones = []; 
 
            if (tipo === 'material') { 
                opciones = PRECIOS_MERCADO.material; 
            } else { 
                opciones = PRECIOS_MERCADO.mano_obra[rubro] || PRECIOS_MERCADO.mano_obra["üõ†Ô∏è Varios"]; 
            } 
 
            if (opciones) { 
                opciones.forEach(item => { 
                    let option = document.createElement('option'); 
                    option.value = item.nombre; 
                    option.setAttribute('data-precio', item.precio);  
                    lista.appendChild(option); 
                }); 
            } 
        } 
 
        const autocompletarPrecio = () => { 
            let nombreIngresado = document.getElementById('nombreInput').value; 
            let tipo = document.getElementById('tipoItemInput').value; 
            let cliente = baseDatos[clienteActualIndex]; 
            let rubro = cliente.rubro || "üõ†Ô∏è Varios"; 
 
            let listaItems = []; 
            if (tipo === 'material') { 
                listaItems = PRECIOS_MERCADO.material; 
            } else { 
                listaItems = PRECIOS_MERCADO.mano_obra[rubro] || PRECIOS_MERCADO.mano_obra["üõ†Ô∏è Varios"]; 
            } 
 
            let encontrado = listaItems.find(item => item.nombre === nombreIngresado); 
 
            if (encontrado) { 
                document.getElementById('precioInput').value = encontrado.precio; 
            } 
        } 
 
 
        // --- FUNCIONES DEL PRESUPUESTO --- 
 
        const agregarProducto = () => { 
            let tipo = document.getElementById('tipoItemInput').value; 
            let nombre = document.getElementById('nombreInput').value; 
            let cantidad = document.getElementById('cantidadInput').value; 
            let precio = document.getElementById('precioInput').value; 
 
            if (nombre === "" || cantidad === "" || precio === "") return; 
 
            let nuevoItem = { 
                tipo: tipo, 
                nombre: nombre, 
                cantidad: parseInt(cantidad),  
                precio: parseFloat(precio) 
            }; 
 
            baseDatos[clienteActualIndex].items.push(nuevoItem); 
             
            document.getElementById('nombreInput').value =""; 
            if(tipo === 'material') document.getElementById('cantidadInput').value = ""; 
             
            document.getElementById('precioInput').value = ""; 
            document.getElementById('nombreInput').focus(); 
             
            guardarDB(); 
            actualizarVistaPresupuesto(); 
             
            Swal.fire({ 
                position: 'top-end', icon: 'success', title: 'SAVED!',  
                showConfirmButton: false, timer: 800, background: '#1a1a2e', color: '#fff' 
            }); 
        } 
 
        const actualizarVistaPresupuesto = () => { 
            let contenedor = document.getElementById('contenedorListas'); 
            contenedor.innerHTML = ""; 
             
            let itemsCliente = baseDatos[clienteActualIndex].items; 
             
            let sumaMateriales = 0; 
            let sumaManoObra = 0; 
            
            let ulMateriales = document.createElement('ul');
            let ulManoObra = document.createElement('ul');

            let hasMateriales = false;
            let hasManoObra = false;
 
            itemsCliente.forEach((producto, i) => { 
                let subtotal = producto.cantidad * producto.precio; 
                 
                if (producto.tipo === 'mano_obra') { 
                    sumaManoObra += subtotal; 
                } else { 
                    sumaMateriales += subtotal; 
                } 
 
                let li = document.createElement('li');
                if (producto.tipo === 'mano_obra') {
                    li.className = 'mano-obra';
                }

                let divInfo = document.createElement('div');
                divInfo.className = 'info-producto';

                let spanNombre = document.createElement('span');
                spanNombre.className = 'nombre-item';

                if (producto.tipo !== 'mano_obra') {
                     let spanCantidad = document.createElement('span');
                     spanCantidad.className = 'cantidad-badge';
                     spanCantidad.textContent = producto.cantidad + 'x';
                     spanNombre.appendChild(spanCantidad);
                }

                let icono = (producto.tipo === 'mano_obra') ? 'üë∑ ' : 'üî© ';
                spanNombre.appendChild(document.createTextNode(icono + producto.nombre));

                let spanDetalle = document.createElement('span');
                spanDetalle.className = 'detalle-item';
                spanDetalle.textContent = `$${producto.precio.toLocaleString()} | Sub: $${subtotal.toLocaleString()}`;

                divInfo.appendChild(spanNombre);
                divInfo.appendChild(spanDetalle);

                let divAcciones = document.createElement('div');
                divAcciones.className = 'acciones';

                let btnEdit = document.createElement('button');
                btnEdit.className = 'btn-edit';
                btnEdit.textContent = 'EDIT';
                btnEdit.onclick = () => editarItem(i);

                let btnDelete = document.createElement('button');
                btnDelete.className = 'btn-delete';
                btnDelete.textContent = 'X';
                btnDelete.onclick = () => borrarItem(i);

                divAcciones.appendChild(btnEdit);
                divAcciones.appendChild(btnDelete);

                li.appendChild(divInfo);
                li.appendChild(divAcciones);
 
                if (producto.tipo === 'mano_obra') { 
                    ulManoObra.appendChild(li);
                    hasManoObra = true;
                } else { 
                    ulMateriales.appendChild(li);
                    hasMateriales = true;
                } 
            }); 
 
            if (hasMateriales) { 
                let titulo = document.createElement('div');
                titulo.className = 'titulo-seccion';
                titulo.textContent = 'üî© MATERIALES';
                contenedor.appendChild(titulo);
                contenedor.appendChild(ulMateriales);
            } 
            if (hasManoObra) { 
                let titulo = document.createElement('div');
                titulo.className = 'titulo-seccion';
                titulo.textContent = 'üë∑ MANO DE OBRA';
                contenedor.appendChild(titulo);
                contenedor.appendChild(ulManoObra);
            } 
            if (itemsCliente.length === 0) { 
                let p = document.createElement('p');
                p.style.color = '#666';
                p.style.fontSize = '0.8em';
                p.textContent = 'LISTA VAC√çA';
                contenedor.appendChild(p);
            } 
 
            document.getElementById('totalMateriales').innerText = sumaMateriales.toLocaleString(); 
            document.getElementById('totalManoObra').innerText = sumaManoObra.toLocaleString(); 
            document.getElementById('precioTotal').innerText = (sumaMateriales + sumaManoObra).toLocaleString(); 
        } 
 
        const borrarItem = (i) => { 
            baseDatos[clienteActualIndex].items.splice(i, 1); 
            guardarDB(); 
            actualizarVistaPresupuesto(); 
        } 
 
        const editarItem = (i) => { 
            let item = baseDatos[clienteActualIndex].items[i]; 
             
            document.getElementById('nombreInput').value = item.nombre; 
            document.getElementById('cantidadInput').value = item.cantidad; 
            document.getElementById('precioInput').value = item.precio; 
             
            let selectTipo = document.getElementById('tipoItemInput'); 
            selectTipo.value = item.tipo || 'material'; 
             
            cambiarPlaceholders(); 
 
            borrarItem(i);  
        } 
 
        const guardarDB = () => { 
            localStorage.setItem('CODEPOP_DB', JSON.stringify(baseDatos)); 
        } 
 
        const descargarExcel = () => { 
            let cliente = baseDatos[clienteActualIndex]; 
            if (cliente.items.length === 0) { 
                Swal.fire({ icon: 'info', title: 'EMPTY', text: 'Agrega items primero', background: '#1a1a2e', color: '#fff', confirmButtonText: 'OK' }); 
                return; 
            } 
 
            let datos = cliente.items.map(item => ({ 
                "Tipo": (item.tipo === 'mano_obra') ? "Mano de Obra" : "Material", 
                "Descripci√≥n": item.nombre,  
                "Cantidad": (item.tipo === 'mano_obra') ? '-' : item.cantidad,  
                "Precio Unitario": item.precio,  
                "Subtotal": item.cantidad * item.precio 
            })); 
 
            let hoja = XLSX.utils.json_to_sheet(datos); 
            let libro = XLSX.utils.book_new(); 
            XLSX.utils.book_append_sheet(libro, hoja, "Presupuesto"); 
            XLSX.writeFile(libro, "Presupuesto_" + cliente.nombre + ".xlsx"); 
        } 
 
        const compartirWhatsapp = () => { 
            let cliente = baseDatos[clienteActualIndex]; 
            let items = cliente.items; 
             
            if (items.length === 0) { 
                Swal.fire({ icon: 'info', title: 'EMPTY', text: 'Nada para enviar', background: '#1a1a2e', color: '#fff', confirmButtonText: 'OK' }); 
                return; 
            } 
 
            let mat = 0; 
            let mo = 0; 
            items.forEach(i => { 
                if(i.tipo === 'mano_obra') mo += (i.cantidad * i.precio); 
                else mat += (i.cantidad * i.precio); 
            }); 
            let total = mat + mo; 
 
            let texto = `Hola ${cliente.nombre}. Te paso el presupuesto de ${cliente.rubro || 'la obra'}:\n\n` + 
                        `üî© Materiales: $${mat.toLocaleString()}\n` + 
                        `üë∑ Mano de Obra: $${mo.toLocaleString()}\n` + 
                        `üí∞ *TOTAL: $${total.toLocaleString()}*\n\n` + 
                        `Av√≠same si avanzamos.`; 
 
            let textoCodificado = encodeURIComponent(texto); 
            window.open(`https://wa.me/?text=${textoCodificado}`, '_blank'); 
        } 
         
        // --- INICIALIZACI√ìN Y EVENTOS --- 
         
        mostrarClientes(); 
 
        document.getElementById('tipoItemInput').addEventListener('change', cambiarPlaceholders); 
        document.getElementById('nombreInput').addEventListener('input', autocompletarPrecio); 
 
        // Teclas R√°pidas 
         document.getElementById('nombreInput').addEventListener('keydown', (e) => { 
            if (e.key === "Enter") { e.preventDefault(); document.getElementById('cantidadInput').focus(); } 
        }); 
        document.getElementById('cantidadInput').addEventListener('keydown', (e) => { 
            if (e.key === "Enter") { e.preventDefault(); document.getElementById('precioInput').focus(); } 
        }); 
        document.getElementById('precioInput').addEventListener('keydown', (e) => { 
            if (e.key === "Enter") agregarProducto(); 
        }); 
 
    </script> 
</body> 
</html>
